<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Leaderboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Luckiest+Guy&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/ticker.css">
</head>
<body>
  <button id="fullscreenBtn" class="fullscreen-button" onclick="toggleFullscreen()">Fullscreen</button>  
  <ul id="leaderboard" class="leaderboard-list"></ul>

<script>
let currentPlayers = {};

function loadLeaderboard() {
  fetch('/api/players')
    .then(response => response.json())
    .then(players => {
      updateLeaderboard(players);
    });
}

function updateLeaderboard(players) {
  const leaderboard = document.getElementById('leaderboard');
  leaderboard.innerHTML = '';

  const sortedPlayers = Object.entries(players)
    .sort(([, a], [, b]) => b.score - a.score); // Highest score first

  sortedPlayers.forEach(([id, player]) => {
    const row = document.createElement('li');

    // Check if player already existed
    if (!currentPlayers[id]) {
      // New player, apply animation
      row.classList.add('fade-in');
    }

    row.innerHTML = `
      <span class="player-name">${player.name}</span>
      <span class="player-score">${player.score}</span>
    `;
    leaderboard.appendChild(row);
  });

  // Update the known current players
  currentPlayers = { ...players };
}

window.addEventListener('load', loadLeaderboard);
setInterval(loadLeaderboard, 3000); // Refresh every 3 seconds
</script>

</body>
</html>