<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Leaderboard</title>
  <link rel="stylesheet" href="/ticker.css">
</head>
<body>
  <button id="fullscreenBtn" class="fullscreen-button" onclick="toggleFullscreen()">Fullscreen</button>

  <div class="header-spacer"></div>

  <ul id="leaderboard" class="leaderboard-list"></ul>

  <script>
    let fullscreenButton = document.getElementById('fullscreenBtn');
    let currentPlayers = {};
    let autoScrollInterval;
    const HEADER_HEIGHT = 200; // Space in pixels for airplane embedded header

    function toggleFullscreen() {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen();
      } else {
        document.exitFullscreen();
      }
    }

    document.addEventListener('fullscreenchange', () => {
      fullscreenButton.style.display = document.fullscreenElement ? 'none' : 'block';
    });

    function loadLeaderboard() {
      fetch('/api/players')
        .then(response => response.json())
        .then(players => {
          updateLeaderboard(players);
        });
    }

    function updateLeaderboard(players) {
      const leaderboard = document.getElementById('leaderboard');
      leaderboard.innerHTML = '';

      const sortedPlayers = Object.entries(players)
        .sort(([, a], [, b]) => b.score - a.score);

      sortedPlayers.forEach(([id, player]) => {
        const row = document.createElement('li');
        row.innerHTML = `
          <span class="player-name">${player.name}</span>
          <span class="player-score">${player.score}</span>
        `;
        leaderboard.appendChild(row);
      });

      if (sortedPlayers.length >= 5) {
        startAutoScroll();
      }
    }

    function startAutoScroll() {
      clearInterval(autoScrollInterval); // Avoid duplicates
      autoScrollInterval = setInterval(() => {
        if ((window.innerHeight + window.scrollY) >= document.body.scrollHeight) {
          setTimeout(() => {
            window.scrollTo({ top: HEADER_HEIGHT, behavior: 'instant' });
          }, 3000); // Pause for 3 seconds at bottom
        } else {
          window.scrollBy(0, 1);
        }
      }, 30); // Very smooth small step scrolling
    }

    // Scroll protection: never allow scrollY < HEADER_HEIGHT
    window.addEventListener('scroll', () => {
      if (window.scrollY < HEADER_HEIGHT) {
        window.scrollTo({ top: HEADER_HEIGHT });
      }
    });

    window.addEventListener('load', () => {
      window.scrollTo({ top: HEADER_HEIGHT }); // Always start below header
      loadLeaderboard();
    });

    setInterval(loadLeaderboard, 3000); // Refresh players every 3 sec
  </script>
</body>
</html>