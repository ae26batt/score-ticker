<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Leaderboard</title>
  <link rel="stylesheet" href="/ticker.css">
</head>
<body>
  <div class="header-spacer"></div>

  <ul id="leaderboard" class="leaderboard-list"></ul>

  <script>
    let currentPlayers = [];
    let displayIndex = 0;
    const HEADER_HEIGHT = 200;
    const TRANSITION_INTERVAL = 2000; // 2 seconds per switch

    async function loadLeaderboard() {
      const response = await fetch('/api/players');
      const playersData = await response.json();

      currentPlayers = Object.entries(playersData)
        .sort(([, a], [, b]) => b.score - a.score)
        .map(([id, player]) => player);

      updateLeaderboard();
    }

    function updateLeaderboard() {
      const leaderboard = document.getElementById('leaderboard');
      leaderboard.innerHTML = '';

      if (currentPlayers.length > 0) {
        const player = currentPlayers[displayIndex];
        const li = document.createElement('li');
        li.innerHTML = `
          <span class="player-name">${player.name}</span>
          <span class="player-score">${player.score}</span>
        `;
        leaderboard.appendChild(li);
      }
    }

    function cyclePlayers() {
      displayIndex = (displayIndex + 1) % currentPlayers.length;
      updateLeaderboard();
    }

    async function start() {
      await loadLeaderboard();
      setInterval(cyclePlayers, TRANSITION_INTERVAL);
      setInterval(loadLeaderboard, 3000); // refresh players every 3s
    }

    // Auto fullscreen on load
    async function requestFullscreen() {
      try {
        await document.documentElement.requestFullscreen();
      } catch (err) {
        console.log('Fullscreen error:', err);
      }
    }

    window.addEventListener('load', () => {
      window.scrollTo({ top: HEADER_HEIGHT });
      requestFullscreen();
      start();
    });

    window.addEventListener('scroll', () => {
      if (window.scrollY < HEADER_HEIGHT) {
        window.scrollTo({ top: HEADER_HEIGHT });
      }
    });

    document.addEventListener('fullscreenchange', () => {
      if (!document.fullscreenElement) {
        requestFullscreen(); // Try to re-enter fullscreen if exited
      }
    });
  </script>
</body>
</html>